# LaTeX 格式指南

## 原则

1. 注重内容与格式分离

1. 尽量遵从 [W3C 中文排版需求](https://w3c.github.io/clreq/)

1. 尽量给出规则出现的理由

## 总体样式

1. 所有文件以 UTF-8（无 BOM）保存，行尾使用 LF
    - 理由：TeX 系统大多部署在 Linux 上，以 Linux 格式为准

1. 每行不超过 100 字符，其中汉字以两个字符计算
    - 理由：便于 Git 管理，同时适用于正常的屏幕尺寸，代码中常用的 80 字符宽对文档来说可能较窄
    - 例外：过长的网址，但可采用短域名服务

1. 代码中禁止出现除 ASCII 空格（`U+0020`）、换行符（`U+000A`）以外的不可见字符
    - 理由：所有字符都应当可被人类阅读

1. 编译使用 XeTeX 引擎
    - 理由：pdfTeX 对中文的支持基本过时，而 LuaTeX 的中文适配仍略有不完备之处，且编译速度较慢

## 标点、符号

## 缩进

1. 使用空格缩进，不使用 `Tab`。每层次的缩进使用 2 个空格
    - 理由：遵循 `l3styleguide`

1. 需使用缩进的地方：
    - `\begin{...}` 与 `\end{...}` 包围的普通环境
    - `{` 与 `}` 包围的代码块
    - 折行代码，应比下一层级再多一级缩进：
        ```latex
        % 下划线 _ 代表空格
        \begin{foo}{This is a long sentence, a long sentence,
        ____a long sentence...}
        __\bar
        \end{foo}
        ```

1. 不使用缩进的地方：
    - 抄录代码块，遵循原始缩进
    - `\section`、`\subsection` 等章节标题之后

## 空格与空白

1. 行尾不允许出现多余空格，空格也不可以独占一行

1. 中西文之间留有空格，但标点前后不保留
    - 例（下划线 `_` 代表空格）：
        - 两边都加：`比赛的_deadline_要到了`
        - 一边加空格：`……。\TeX{}_是一个……`
        - 两边都不加：`高德纳（Donald~E. Knuth）`

1. 除非必要，不可使用全宽（全角）空格

1. 段落使用空行标记，通常情况不使用 `\par`，更不可以使用 `\\`
    - 理由：使用空行标记段落可以大大提高可读性；`\\` 是硬断行，不表示切换段落

1. `\section`、`\subsection` 等章节标题前后留出 1 个空行

1. 使用不可断行空格（`~`）的地方：
    - 交叉引用：`如图~\ref{fig:...}`
    - 教名之间：`Donald~E. Knuth`
    - 例外：
        - `见\faqref{...}`

## 公式

1. 行内公式使用 `$...$`，不使用 `\(...\)`

## 本文档特有

1. 问题使用 `\faq` 命令标明，具体用法：
    ```latex
    \faq[<options>]{<question>}{<id>}
    ```
    这里的 `<id>` 需保证唯一性。
    
1. 对问题的交叉引用使用`\faqref{<id>}`命令。

1. 每个问题之间留出 2 个空行

1. 行间抄录（代码、命令等）使用 `|...|`（TODO：FAQ 标题中使用\cs{foocmd}或|foocmd|有可能引起显示或编译错误。

1. 宏包、文档类分别使用 `\pkg{...}`、`\cls{...}` 标记

1. 书籍的中文名称使用 `《...》`，英文名称使用 `\book{...}`

1. 录入TeX代码目前可使用texcode、texinlist、texlist环境；录入sh、bat、python、lua、json代码可分别使用shcode、batcode、pycode、luacode、jsoncode环境。

## 杂项

1. TeX、LaTeX 等使用 `\TeX{}`、`\LaTeX{}`，以保证正确排版以及之后的空格。
    - 理由：遵循 `l3styleguide`
    - 例外：
        - LaTeX3 使用 `\LaTeX3`
        - The TeXbook 使用 `The \TeX book`

## 开发一个宏包/文档类需要哪些知识

LaTeX 的宏包可以形式地分为如下几类：
- 模板类。即制作文章、书籍模板。基本上是对已有宏包（及功能）的整合。
- 需求类。实现特定需求。如修改版面参数，设置页眉页脚，显示代码，绘图等。
- 辅助类。即实现其它需求的通用前置。如 `etoolbox`、`keyval`、`atbegshi` 等。
- 字体类。增加或修改文档字体。
- 其它。如 `microtype`。

然而给出这 5 类宏包只是让读者有一个感性的理解，事实上很难把一个宏包归为某一类，如 `xpatch` 宏包既可以认为是实现某一特定需求，也可以认为是实现其它需求的前置。同时，一个宏包也完全可以同时具有上述多种类别。这里对宏包进行分类只是便于后续的讨论而已。

读者可以从第 15 章了解到常见宏包的功能。

回到正题上来，开发宏包需要的知识与它们的分类有一定关联。如对于模板类，只需要了解如何修改版面大小如何修改字体等等，这些需求基本上都已有完善的宏包实现它们了，宏包作者只需知道这些需要分别由哪些宏包实现，然后阅读相应宏包的文档即可。对于需求类和辅助类，目前 LaTeX 的宏包已经极为丰富，多数需求都已经有宏包实现，因此如果需要实现某一需求，直接从实现这一需求的宏包中学习即可。此外，还可能需要了解 TeX 和 LaTeX 的基本知识，甚至需要了解 LaTeX 的实现，以及所用的 TeX 引擎和驱动的文档。（本章后文对此有介绍。）例如实现 `multicol`、`paracol` 宏包不仅需要了解 TeX 的分页算法，还需要知道 LaTeX 的输出例程（output routine）。而 `graphics`、`color`、`hyperref` 的实现方式与编译时使用的驱动有关，对于 `xeCJK`、`luatex-ja` 等宏包，它们一方面依赖于具体的引擎，另一方面也基于特定地区的排版规范、标准和惯例，对于 `tikz` 和 `pstricks`，它们的底层基于驱动提供的功能，再使用 TeX 宏包装之，如 `tikz` 的某些功能直接来自于 PDF 标准，`pstricks` 则基于 postscript，由于涉及图形相关的功能，甚至需要了解一点图形学的知识。对于字体类，则需要了解 LaTeX 的字体机制（NFSS），或是 `fontspec` 宏包的使用方式，还需要对字体知识有一定的了解。

除此之外，LaTeX 宏包还应注重兼容性。纵向的，即是向后兼容；横向的，即是兼容其它常用宏包。在编写宏包时，最好考虑一下横向兼容性，这有时需要我们了解这些宏包的具体实现。

## 如何学习开发宏包/文档类所需的知识

前已述及，所需的知识与开发的宏包的类别有关，开发除了模板以外（甚至包括模板）的其它宏包，所需知识总是来自于 TeX 引擎及驱动提供的功能。

以下列出推荐阅读的书目或文档：
- The TeXbook。目前常用的引擎都是以 TeX 和 eTeX 为基础，因此 The TeXbook 和 eTeX 手册几乎是开发需求类和辅助类宏包必读的。其中 eTeX 手册可在终端中执行 `texdoc etex` 以打开。
- TeX by Topic。与 The TeXbook 类似的书目，描述 TeX 底层的功能。执行 `texdoc texbytopic` 以打开。
- `clsguide.pdf`。编写宏包和文档类的简短指南。执行 `texdoc clsguide` 以打开。
- `interface3.pdf`。LaTeX3 的说明文档。LaTeX3 可以算作是一套辅助类宏包，它为 TeX 的功能提供了更加一致的、易用的接口，并提供了定义键值接口、处理列表、正则表达式等功能。目前，LaTeX3 已经集成进 LaTeX 内核，越来越多的宏包及文档类使用 LaTeX3 开发。初学者选择 LaTeX3 开发是一个不错的选择。执行 `texdoc interface3` 以打开。
- The LaTeX Companion 第三版。这是目前关于 LaTeX 的最新的书籍。几乎包含 LaTeX 各个方面的知识。内容将近 2000 页，当作手册查阅是个不错的选择。
- 各引擎和驱动的文档。可尝试执行 `texdoc 引擎和驱动的名称` 以打开其文档。
- 其它宏包。见第 15 章。

另外，由于 TeX 引擎和 LaTeX 格式均是开源的，LaTeX 宏包又是以纯文本形式发布，因此其源码总是第一手的、最可靠的资料。

正如学习其它知识一样，与其等到读完上面这些资料再开始，不如现在立刻动手开始写一个模板，从最简单的开始写起，功能无需多么复杂，在实践中学习、理解和运用。
